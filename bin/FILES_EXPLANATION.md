# BioTTA æ–‡ä»¶è¯´æ˜å’Œä½¿ç”¨æŒ‡å—

## ğŸ“ æ–‡ä»¶åˆ†ç±»

### ğŸ”¥ **æ ¸å¿ƒä½¿ç”¨æ–‡ä»¶ï¼ˆä½ å¿…é¡»çŸ¥é“çš„ï¼‰**

è¿™äº›æ˜¯**ä¸»è¦ä½¿ç”¨**çš„æ–‡ä»¶ï¼š

#### 1. `main.py` â­ **ä¸»å…¥å£è„šæœ¬ï¼ˆæ¨èï¼‰**
**ä½œç”¨**: æ•´åˆStep1å’ŒStep2ï¼Œä¸€é”®è¿è¡Œå®Œæ•´æµç¨‹
**ç”¨æ³•**:
```bash
python main.py --input your_image.nii.gz --config config.yaml
```
**åŠŸèƒ½**:
- è‡ªåŠ¨æ‰§è¡ŒStep1ï¼ˆé•¿åº¦é¢„æµ‹ï¼‰+ Step2ï¼ˆç«¯ç‚¹å®šä½ï¼‰
- æ”¯æŒå•ä¸ªæ–‡ä»¶æˆ–æ‰¹é‡å¤„ç†
- è‡ªåŠ¨ä¿å­˜æœ€ç»ˆç»“æœï¼ˆ22ä¸ªç«¯ç‚¹åæ ‡ï¼‰

---

#### 2. `config.yaml` â­ **é…ç½®æ–‡ä»¶**
**ä½œç”¨**: é…ç½®æ‰€æœ‰å‚æ•°ï¼ˆæ¨¡å‹è·¯å¾„ã€æ¨¡æ¿è·¯å¾„ã€å‚æ•°ç­‰ï¼‰
**å†…å®¹**:
- æ¨¡å‹æ–‡ä»¶è·¯å¾„
- æ¨¡æ¿æ–‡ä»¶è·¯å¾„  
- Step1å’ŒStep2çš„å‚æ•°
- è¾“å‡ºè®¾ç½®

**ä½ éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†**:
```yaml
paths:
  step1_model: "./models/ä½ çš„step1æ¨¡å‹.pth"
  step2_model: "./models/ä½ çš„step2æ¨¡å‹.pth"
  template:
    image_folder: "./templates/template_image"
    label_folder: "./templates/template_label"
```

---

### ğŸ“¦ **æ¨¡å—æ–‡ä»¶ï¼ˆä»£ç å†…éƒ¨ä½¿ç”¨ï¼Œä¸éœ€è¦ç›´æ¥è¿è¡Œï¼‰**

è¿™äº›æ˜¯**è¢«main.pyè°ƒç”¨çš„æ¨¡å—**ï¼Œä¸€èˆ¬ä¸éœ€è¦ç›´æ¥è¿è¡Œï¼š

#### 3. `biotta_step1.py`
**ä½œç”¨**: Step1çš„æ¨¡å—åŒ–å®ç° - é¢„æµ‹11ä¸ªé•¿åº¦
**è¢«è°è°ƒç”¨**: `main.py`
**ä½ ä¸éœ€è¦**: ç›´æ¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶

#### 4. `biotta_step2.py`  
**ä½œç”¨**: Step2çš„æ¨¡å—åŒ–å®ç° - TTAç«¯ç‚¹å®šä½
**è¢«è°è°ƒç”¨**: `main.py`
**ä½ ä¸éœ€è¦**: ç›´æ¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶

#### 5. `biotta_output.py`
**ä½œç”¨**: è¾“å‡ºæ ¼å¼åŒ–æ¨¡å—
**è¢«è°è°ƒç”¨**: `main.py`
**ä½ ä¸éœ€è¦**: ç›´æ¥è¿è¡Œè¿™ä¸ªæ–‡ä»¶

---

### ğŸ“š **åŸå§‹è„šæœ¬ï¼ˆå‚è€ƒç”¨ï¼Œå¯å•ç‹¬è¿è¡Œï¼‰**

è¿™äº›æ˜¯**åŸå§‹çš„ç‹¬ç«‹è„šæœ¬**ï¼Œå¯ä»¥å•ç‹¬è¿è¡Œï¼Œä½†é€šå¸¸ä¸æ¨èï¼š

#### 6. `step1_length_prediction.py`
**ä½œç”¨**: åŸå§‹çš„Step1è„šæœ¬ï¼Œåªèƒ½é¢„æµ‹é•¿åº¦
**ç”¨æ³•**: å¦‚æœä½ åªæƒ³å•ç‹¬è¿è¡ŒStep1
```bash
python step1_length_prediction.py
```
**æ³¨æ„**: éœ€è¦åœ¨ä»£ç ä¸­æ‰‹åŠ¨ä¿®æ”¹è·¯å¾„

#### 7. `step2_biometry_TTA.py`
**ä½œç”¨**: åŸå§‹çš„Step2è„šæœ¬ï¼Œåªèƒ½å®šä½ç«¯ç‚¹
**ç”¨æ³•**: å¦‚æœä½ åªæƒ³å•ç‹¬è¿è¡ŒStep2
```bash
python step2_biometry_TTA.py
```
**æ³¨æ„**: 
- éœ€è¦å…ˆè¿è¡ŒStep1å¾—åˆ°é•¿åº¦é¢„æµ‹ç»“æœ
- éœ€è¦åœ¨ä»£ç ä¸­æ‰‹åŠ¨ä¿®æ”¹è·¯å¾„

---

### ğŸ”§ **è¾…åŠ©æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰**

#### 8. `example_usage.py`
**ä½œç”¨**: ä½¿ç”¨ç¤ºä¾‹ä»£ç 
**ç”¨æ³•**: æŸ¥çœ‹ç¤ºä¾‹ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨
**ä½ ä¸éœ€è¦**: ç›´æ¥è¿è¡Œï¼ˆé™¤éè¦å­¦ä¹ ï¼‰

#### 9. `README.md` / `QUICKSTART.md`
**ä½œç”¨**: æ–‡æ¡£è¯´æ˜
**ç”¨æ³•**: é˜…è¯»äº†è§£è¯¦ç»†ç”¨æ³•

#### 10. `run_analysis.py`
**ä½œç”¨**: å¦ä¸€ä¸ªæ•´åˆè„šæœ¬ï¼ˆåŠŸèƒ½ä¸main.pyç±»ä¼¼ï¼‰
**çŠ¶æ€**: å¯ä»¥ä½¿ç”¨ï¼Œä½†æ¨èä½¿ç”¨`main.py`

---

## ğŸ¯ ä½¿ç”¨æµç¨‹

### **æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ï¼ˆæ¨èï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‡†å¤‡æ–‡ä»¶ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ nii.gzå›¾åƒæ–‡ä»¶
     â”œâ”€ config.yamlé…ç½®æ–‡ä»¶
     â”œâ”€ æ¨¡å‹æ–‡ä»¶ï¼ˆ.pthï¼‰
     â””â”€ æ¨¡æ¿æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. è¿è¡Œå‘½ä»¤ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€ python main.py --input å›¾åƒæ–‡ä»¶ --config config.yaml
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. è·å¾—ç»“æœ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚
     â”œâ”€ results.csv (åŒ…å«22ä¸ªç«¯ç‚¹åæ ‡)
     â””â”€ results.json (ç»“æ„åŒ–æ•°æ®)
```

### **è¯¦ç»†æµç¨‹**

```
ç”¨æˆ·è¿è¡Œå‘½ä»¤
    â†“
main.py å¯åŠ¨
    â†“
è¯»å– config.yaml
    â†“
è°ƒç”¨ biotta_step1.py â†’ Step1: é¢„æµ‹11ä¸ªé•¿åº¦
    â†“
è°ƒç”¨ biotta_step2.py â†’ Step2: TTAå®šä½22ä¸ªç«¯ç‚¹
    â†“
è°ƒç”¨ biotta_output.py â†’ æ ¼å¼åŒ–è¾“å‡º
    â†“
ä¿å­˜ results.csv å’Œ results.json
```

---

## ğŸ“ å¿«é€Ÿå¼€å§‹ç¤ºä¾‹

### ç¤ºä¾‹1: å¤„ç†å•ä¸ªæ–‡ä»¶

```bash
# 1. å‡†å¤‡å¥½é…ç½®æ–‡ä»¶ config.yaml
# 2. è¿è¡Œ
python main.py --input data/sample.nii.gz --config config.yaml
```

**è¾“å‡º**:
- `results/results.csv` - CSVæ ¼å¼ç»“æœ
- `results/results.json` - JSONæ ¼å¼ç»“æœ
- `results/sample/landmarks.txt` - åæ ‡æ–‡æœ¬æ–‡ä»¶
- `results/sample/landmarks.png` - å¯è§†åŒ–å›¾åƒ

### ç¤ºä¾‹2: æ‰¹é‡å¤„ç†æ–‡ä»¶å¤¹

```bash
python main.py --input data/images_folder/ --config config.yaml
```

**è¾“å‡º**:
- `results/results.csv` - æ‰€æœ‰å›¾åƒçš„ç»“æœ
- `results/results.json` - æ‰€æœ‰å›¾åƒçš„ç»“æœ
- `results/{image_name}/` - æ¯ä¸ªå›¾åƒçš„è¯¦ç»†ç»“æœ

---

## â“ å¸¸è§é—®é¢˜

### Q1: æˆ‘åº”è¯¥ç”¨å“ªä¸ªæ–‡ä»¶ï¼Ÿ

**ç­”**: ç”¨ `main.py`ï¼è¿™æ˜¯æ•´åˆå¥½çš„ä¸»å…¥å£ã€‚

### Q2: `run_analysis.py` å’Œ `main.py` æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”**: 
- `main.py` - æ¨¡å—åŒ–è®¾è®¡ï¼Œä»£ç æ›´æ¸…æ™°
- `run_analysis.py` - å¦ä¸€ä¸ªç‰ˆæœ¬ï¼ŒåŠŸèƒ½ç±»ä¼¼
- **æ¨èç”¨ `main.py`**

### Q3: å¯ä»¥åªè¿è¡ŒStep1å—ï¼Ÿ

**ç­”**: å¯ä»¥ï¼Œæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š
1. è¿è¡Œ `step1_length_prediction.py`ï¼ˆåŸå§‹è„šæœ¬ï¼Œéœ€è¦æ‰‹åŠ¨æ”¹è·¯å¾„ï¼‰
2. ä¿®æ”¹ `main.py`ï¼Œè®©å®ƒåªè¿è¡ŒStep1

### Q4: å¯ä»¥åªè¿è¡ŒStep2å—ï¼Ÿ

**ç­”**: å¯ä»¥ï¼Œä½†éœ€è¦ï¼š
1. å…ˆæœ‰Step1çš„é¢„æµ‹ç»“æœï¼ˆCSVæ ¼å¼ï¼‰
2. è¿è¡Œ `step2_biometry_TTA.py`ï¼ˆåŸå§‹è„šæœ¬ï¼Œéœ€è¦æ‰‹åŠ¨æ”¹è·¯å¾„ï¼‰

### Q5: ç»“æœåœ¨å“ªé‡Œï¼Ÿ

**ç­”**: é»˜è®¤åœ¨ `./results/` ç›®å½•ï¼ˆå¯åœ¨config.yamlä¸­ä¿®æ”¹ï¼‰

---

## ğŸ“‚ ç›®å½•ç»“æ„å»ºè®®

```
BioTTA/
â”œâ”€â”€ main.py                    â† ä¸»å…¥å£ï¼ˆè¿è¡Œè¿™ä¸ªï¼‰
â”œâ”€â”€ config.yaml                â† é…ç½®æ–‡ä»¶ï¼ˆä¿®æ”¹è¿™ä¸ªï¼‰
â”œâ”€â”€ biotta_step1.py            â† æ¨¡å—ï¼ˆä¸éœ€è¦ç›´æ¥è¿è¡Œï¼‰
â”œâ”€â”€ biotta_step2.py            â† æ¨¡å—ï¼ˆä¸éœ€è¦ç›´æ¥è¿è¡Œï¼‰
â”œâ”€â”€ biotta_output.py           â† æ¨¡å—ï¼ˆä¸éœ€è¦ç›´æ¥è¿è¡Œï¼‰
â”œâ”€â”€ step1_length_prediction.py â† åŸå§‹è„šæœ¬ï¼ˆå‚è€ƒç”¨ï¼‰
â”œâ”€â”€ step2_biometry_TTA.py      â† åŸå§‹è„šæœ¬ï¼ˆå‚è€ƒç”¨ï¼‰
â”œâ”€â”€ lib/                       â† åº“æ–‡ä»¶
â”œâ”€â”€ models/                    â† æ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ step1_xxx.pth
â”‚   â””â”€â”€ step2_xxx.pth
â”œâ”€â”€ templates/                 â† æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ template_image/
â”‚   â””â”€â”€ template_label/
â””â”€â”€ results/                   â† è¾“å‡ºç»“æœï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â”œâ”€â”€ results.csv
    â”œâ”€â”€ results.json
    â””â”€â”€ {image_name}/
        â”œâ”€â”€ landmarks.txt
        â””â”€â”€ landmarks.png
```

---

## ğŸ“ æ€»ç»“

**ä¸€å¥è¯æ€»ç»“**:
- **ä¸»è¦ç”¨**: `main.py` + `config.yaml`
- **ä¸éœ€è¦ç®¡**: `biotta_step1.py`, `biotta_step2.py`, `biotta_output.py`ï¼ˆå®ƒä»¬è¢«main.pyè‡ªåŠ¨è°ƒç”¨ï¼‰
- **å‚è€ƒç”¨**: `step1_length_prediction.py`, `step2_biometry_TTA.py`ï¼ˆåŸå§‹è„šæœ¬ï¼‰

**ä½¿ç”¨æµç¨‹**:
1. é…ç½® `config.yaml`
2. è¿è¡Œ `python main.py --input å›¾åƒ --config config.yaml`
3. åœ¨ `results/` ç›®å½•æŸ¥çœ‹ç»“æœ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœè¿˜æœ‰ç–‘é—®ï¼Œè¯·æŸ¥çœ‹ï¼š
- `README.md` - è¯¦ç»†æ–‡æ¡£
- `QUICKSTART.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `example_usage.py` - ä»£ç ç¤ºä¾‹

